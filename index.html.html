<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sci-Fi Spacecraft HUD</title>
    <style>
        /* ... your full CSS is unchanged ... */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        /* ... all other styles exactly as before ... */
        /* (snip for brevity, your original CSS is fine) */
    </style>
</head>
<body>
    <div class="hud-container">
        <div class="controls-section">
            <!-- ... all your buttons unchanged ... -->
            <!-- (snip for brevity, your original HTML buttons are fine) -->
        </div>
    </div>

    <script>
        // --- HTTP-in URL for the HUD, supplied as ?url=... by LSL ---
        let HUD_HTTP_URL = '';
        document.addEventListener('DOMContentLoaded', () => {
            // Get the HTTP-in URL from the query parameter
            const params = new URLSearchParams(window.location.search);
            HUD_HTTP_URL = params.get('url');
            // Select primary weapon by default
            document.querySelector('.primary-weapon').classList.add('selected');
        });

        // Send a command to the LSL HUD via HTTP POST
        function sendToSL(command, value) {
            if (!HUD_HTTP_URL) {
                alert("HUD is not initialized, URL missing.");
                return;
            }
            fetch(HUD_HTTP_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: `command=${encodeURIComponent(command + ":" + value)}`
            }).catch(console.error);
        }

        // Toggle button functionality
        function toggleButton(button) {
            button.classList.toggle('active');
            addClickEffect(button);

            // Get button state and send to SL
            const label = button.querySelector('.label').textContent;
            const state = button.classList.contains('active') ? '1' : '0';
            sendToSL(label.toUpperCase().replace(' ', '_'), state);
        }

        // Weapon selection (mutually exclusive)
        function selectWeapon(button, type) {
            document.querySelectorAll('.primary-weapon, .secondary-weapon').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
            addClickEffect(button);
            sendToSL('WEAPON', type.toUpperCase());
        }

        // Options menu
        function openOptions() {
            addClickEffect(event.currentTarget || this);
            sendToSL('OPTIONS', 'OPEN');
        }

        // Click ripple effect
        function addClickEffect(button) {
            button.classList.add('clicked');
            setTimeout(() => {
                button.classList.remove('clicked');
            }, 600);
        }

        // Optional: Accept messages from LSL for HUD updates (future extension)
        window.addEventListener('message', function(e) {
            if (e.data && e.data.type === 'SL_UPDATE') {
                updateHUDState(e.data.state);
            }
        });

        // Optional: Update HUD button states from LSL (for two-way sync)
        function updateHUDState(state) {
            if (state.engines !== undefined) {
                const enginesBtn = document.querySelector('.engines-btn');
                if (state.engines) enginesBtn.classList.add('active');
                else enginesBtn.classList.remove('active');
            }
            // Add similar logic for other systems if you implement feedback
        }
    </script>
</body>
</html>
